# 논리 모델링

## 논리 모델링이란
비즈니스에서 필요로 하는 데이터를 명확하고 구체적으로 정의하는 과정으로 비즈니스 전체 영역에 대한 상세한 수준의 데이터 구조를 설계한다. 데이터 주제영역 단위로 데이터 모델링을 진행하고 데이터에 관한 업무 특성을 모두 반영해야 한다. 핵심 엔티티를 중심으로 업무에 필요한 하위 엔티티로 확장하면서 엔티티를 상세화한다.
* 기초 논리 데이터 모델링 : 주제영역별로 핵심 엔티티를 도출하고 그들 간의 주요 관계를 설계하고, 엔티티별로 식별자를 정의하며 주요 속성을 도출한다.
* 논리 데이터 모델링 : 모든 업무영역에 필요한 데이터 모델을 설계하고, 시스템 관점에서 필요한 데이터 항목은 반영하지 않는다.

데이터에 대한 이력관리 대상은 꼭 필요한 부분만 반영하고, 단순한 정보변경 이력, 과거 통계 정보의 재현을 위한 이력은 반영하지 않아도 된다.

## 엔티티 정의 및 상세화
__핵심 엔티티(기준정보)__ : 업무처리와 상관없이 독립적으로 이미 정의한 엔티티이거나, 업무를 위해 미리 정의한 엔티티다. 단독으로 존재하거나 다른 핵심 엔티티에 종속되기도 한다. 데이터 모델링 과정에서 가장 먼저 분석해야할 대상이며 모든 업무 행위는 핵심 엔티티에 의해 정의되거나 핵심 엔티티 간의 관계에 의해 정의된다. 핵심 엔티티는 업무 행위의 주체가 되거나 행위의 대상이 되는 경우가 대부분이다.

성격에 따라 다음과 같이 분류할 수 있다.
* 유형 및 분류 - 각종 코드 정보
* 업무 규칙 및 지식 - 규정, 이벤트 발생 조건
* 업무 주체 및 대상 - 현실세계에 실제로 존재하는 유무형의 실체에 해당, 고객, 사원, 부서 등
* 장소 - 장소 자체가 의미를 가지는 엔티티도 있고, 다른 핵심 엔티티의 공간이나 위치 속성으로 존재하기도 한다.

핵심 엔티티는 독립적으로 존재하고 식별할 수 있다.

__중요 엔티티(업무기본)__ : 업무 주체와 업무 대상간의 거래나 업무 행위에 의해 발생하며 주문, 약정, 입출고처럼 구별 가능한 '업무 행위'를 대표하는 엔티티다. 핵심 엔티티의 종속적인 성격을 가지면서 업무 영역내에서는 비교적 독립적인 성격(강한 엔티티)를 가진다. 상위 엔티티의 주 식별자를 상속받지 않고, 독립적인 주 식별자를 가지고 있다는 점에서 다른 엔티티들과 구분된다. 그렇다해도 독립된 엔티티라 할 수 없고, 업무 행위의 주체나 대상에 종속되는 경우가 대부분이다.

중요 엔티티는 업무의 핵심 기능과 밀접한 관련이 있고, 주요 업무에서 반복하여 발생하는 데이터를 관리하는 엔티티이다.(업무 영역에서 가장 중심적인 업무처리에 대한 데이터 집합)

__행위 엔티티(업무상세)__ : 업무 행위에 대한 상세내역 및 업무 결과에 대한 '상태'를 나타내는 엔티티이며 중요 엔티티에 종속되거나 다른 행위 엔티티에 종속된다. 행위 엔티티는 하위에 또 다른 행위 엔티티를 가질 수 있고, 정규화 과정에서 다른 엔티티로 분리하기도 한다. 일반적으로 행위 엔티티는 중요 엔티티에 종속되므로 중요 엔티티를 삭제하면 행위 엔티티도 더 이상 관리하지 않는다.

* 상세/내역 : 주문내역이나 예산내역처럼 중요 엔티티에 해당하는 주문이나 예산을 구성하는 항목 단위로 분류하거나 더 작은 단위로 세분화한 엔티티에 해당한다. 마스터, 디테일 관계에서 디테일에 해당하는 엔티티로 봐도 된다.
* 상태 : 상태는 업무처리 흐름에 대한 상태를 관리한다. 업무처리 과정에서 반드시 발생하는 데이터이며 상태코드 값은 사전에 업무적으로 이미 정해진 값을 사용한다.
* 이력 : 원래 관리하던 데이터가 변경되었을 때 변경 전 데이터를 추가로 관리하는 엔티티다. 속성 전체를 이력으로 관리하는 경우 원래 엔티티와 동일한 형태로 이력 엔티티를 설계하여 변경된 항목 구분없이 전체 데이터를 생성하여 관리한다. 일부 속성만 관리하는 경우 관리할 속성을 식별하고 코드화하여 행으로 관리한다. 그리고 해당 속성의 값이 변경된 경우에만 데이터를 생성하여 관리한다.
* 기타 : 거래로그, 시스템 로그, 연계 데이터, 집계 데이터 등으로 구분

### 엔티티 도출 및 식별
엔티티 도출 및 식별은 관심 대상이 되는 데이터를 분석하여 엔티티로 구체화하는 과정이다. 현행 데이터모델을 바탕으로 현업의 기능 및 데이터 요구사항을 정의하면서 엔티티를 도출하고 식별한다. 현행 데이터모델이 없다면 리버스 작업을 먼저 수행하는 것이 좋다. 먼저 현행 데이터 모델에서 불필요한 업무나 기능과 관련된 테이블을 식별하여 삭제하고 현업과 인터뷰 전에 엔티티명, 관계선, 속성명을 정리하는 것이 좋다.

속성명은 분류어가 없는 경우 데이터타입을 기준으로 샘플 데이터를 조사하여 보완할 수 있다. 예)VARCHAR(4) 데이터타입의 '01', '02' 식으로 데이터가 들어있다면 코드 도메인으로 추정 가능, VARCHAR(100)은 명칭, 내용 도메인으로 볼 수 있다. 그래도 한계가 있기 때문에 시스템 운영담당자를 통해 속성명을 구체화해야한다.

### 엔티티 명명
엔티티명은 전체 주제영역 내에서 유일하게 부여하며 너무 길지 않아야하고, 구체적인 용어를 사용하는 것이 좋다.

[명명규칙]
1) 엔티티 명은 단수형 명사를 사용한다. 예)고객, 부서, 상품 ...
2) 엔티티에서 관리하는 데이터의 범위와 내용을 명확히 정의하기 위해 수식어를 사용한다. 예) 주소->고객주소, 입금내역->계약입금내역
3) 교차 엔티티는 양쪽 엔티티 명의 조합을 기본 명칭으로 사용한다. 예)계약 + 상품 -> 계약상품
4) 낱 단어는 정확한 의미를 파악하기 어려우므로 아주 예외적인 경우를 제외하고는 사용하지 않는다. 예) 고객별실적 -> 고객단위실적
5) 한글과 알파벳 대문자를 사용하고, 숫자, 언더바를 제한적으로 허용, 띄어쓰기나 기타 특수문자는 사용하지 않는다.

### 엔티티 정의
엔티티 정의는 엔티티에 대한 설명으로 관리하는 데이터 집합을 규정, 데이터에 대한 발생규칙, 업무규칙 등을 기술함으로써 엔티티를 정의하는 과정이다. 독립적인 엔티티는 식별자가 이미 존재하므로 식별자를 중심으로 정의하는 것이 좋고, 종속 엔티티는 엔티티 간 관계의 성격을 파악하여 집합 단위나 데이터 발생 기준을 정의하는 것이 좋다.

업무 성격에 따라 다양한 역할을 담당하게 되므로 실체는 독립적인 엔티티로 보는 것이 합리적이고, 역할은 관계 엔티티로 정의하는 것이 적합하다.

엔티티를 정의하는 방법은 엔티티의 성격에 따라 엔티티 자체만으로 정의 가능한 부분(고객, 상품 등 핵심 엔티티)도 있고, 엔티티에서 관리하는 속성을 중심으로 파악(주문 등 중요 엔티티)할 수도 있으며, 다른 엔티티와의 관계를 바탕으로 정의(주문결제 등 행위 엔티티)할 수도 있다.

### 엔티티 통합
엔티티 통합은 엔티티 일반화와 특수화와 관련이 있다. 예)개인고객과 법인고객을 일반화하여 고객 엔티티로 통합, 개별 속성은 특수화를 통해 개인고객, 법인고객 서브타입 엔티티로 정의한다. 엔티티 통합은 핵심 엔티티에서 자주 볼 수 있다. 핵심 엔티티는 다른 엔티티와 많은 관계를 가지는 특성이 있어 엔티티를 통합할 경우 관계도 통합되어 관계가 단순해지고 명확해진다.

엔티티 통합은 구조적인 측면에서 하나의 엔티티로 설계하는 경우도 있고, 여러 시스템이나 업무에서 개별적으로 관리하는 데이터를 모아 관리하는 데이터 통합도 있다. 데이터를 통합하는 과정은 데이터에 대한 분류체계, 식별체계, 속성체계를 일원화하는 과정으로 볼 수 있다.

* 분류체계 : 회원이나 고객을 웹회원, 마케팅회원, 개인, 법인 등으로 다르게 식별한 경우 -> 개인, 법인, 단체 등 동일한 유형으로 분류체계 일원화
* 식별체계 : 개인의 경우 내국인은 주민등록번호, 외국인은 외국인등록번호, 여권번호로 식별
* 속성체계 : 공통으로 관리하는 속성, 개별로 관리하는 속성으로 분류

또 데이터 통합시 데이터에 대한 오너십과 우선순위를 정하는 일도 중요하다. 예) 고객정보를 변경하는 경우 고객 속성 전체를 변경할지, 주소 연락처만 변경할지 정의

## 관계도출 및 정의
관계는 부모 자식 엔티티 간의 '종속 관계'와 주체나 대상이 되는 엔티티를 참조하는 '참조 관계'로 나눌 수 있다. 종속 관계는 중요 엔티티와 행위 엔티티간에 자주 나타나며, 부모 엔티티의 식별자를 주 식별자로 상속받는다.(식별관계) 참조 관계는 핵심 엔티티와 중요 엔티티, 중요 엔티티와 중요 엔티티 간의 관계에 해당하며 참조되는 엔티티의 주 식별자를 일반 속성으로 상속받는다.(비식별관계)

엔티티간의 관계가 명확하게 정의되어 있어야 참조 무결성 제약조건을 추가하거나 참조 관계를 구현하여 데이터 품질을 높일 수 있다.

### 관계 도출
관계를 업무 행위의 성격에 따라 다음과 같이 구분할 수 있다.
* 주체 : 핵심 엔티티와 중요 엔티티 간의 관계에서 업무 행위의 주체를 나타낸다. 
* 대상 : 핵심 엔티티와 중요엔티티/행위 엔티티 간의 관계에서 업무 행위의 대상을 나타낸다.
* 상세 : 중요 엔티티와 행위 엔티티 간의 관계에 해당한다.
* 인과 : 중요 엔티티/행위 엔티티와 중요 엔티티/행위 엔티티 간의 관계에서 업무 행위의 원인이나 근거를 나타낸다.
* 역할/자격 : 핵심 엔티티와 다른 엔티티 간의 관계에서 업무 행위에 대해 특정 역할을 나타낸다.
* 구성 : 핵심 엔티티와 핵심 엔티티 간의 관계에서 특정 개념을 완성하기 위한 부분 개념과의 관계를 나타낸다.
* 참조 : 핵심 엔티티와 다른 엔티티 간의 관계에서 엔티티 고유 정보에 부속한 정보들을 참조한다.

### 관계 정의
엔티티 간의 관계수와 선택성, 식별자 상속을 정의한다.

* 1:1 필수-필수 관계 - 업무적으로 1:1 관계이면서 양쪽이 반드시 필요한 경우는 별로 없다. 예)회원 가입시 실명인증
* 1:1 필수-선택 관계 - 전체 집합의 일부 영역에 대한 정보를 별도로 관리하는 경우에 해당
* 1:1 선택-선택 관계 - 예)사원과 인턴과정 엔티티에서 사원은 한 번의 인턴 과정을 거치거나 인턴 과정 없이 바로 채용될 수 있다.
* 1:M 필수-필수 관계 - 중요 엔티티와 행위 엔티티 간의 직접적인 관계에 해당
* 1:M 필수-선택 관계 - 예)하나의 주문은 배송이 여러 건 있을 수 있고, 하나의 배송은 반드시 원인이 되는 주문이 존재해야한다.
* 1:M 선택-선택 관계 - 비식별자 상속을 통한 참조 관계이면서 참조하는 엔티티가 다른 업무를 포함하는 경우에 해당한다.
* M:N 관계 - 예) 한 부서에는 여러 명의 직원이 소속되어 있고, 일부 직원은 여러 부서에 속할 수 있다. 개념 모델에서 핵심 에닡티나 중요 엔티티간의 관계를 개념적으로 표현할 때 나타낸다.

### 관계명(동사) 부여
관계명을 제3자 입장에서 표현하는 방법(관계명)과 당사자 입장에서 표현하는 방법(관계동사)으로 구분하여 표현한다. 관계명이 없어도 직관적으로 관계를 알 수 있는 경우가 많아 관계를 파악하는데 어렵거나 모호한 경우에 관계명을 부여한다. 관계 동사를 부여할 때 양쪽의 의미가 많이 다를 때만 양쪽 모두 명칭을 부여하는 것이 좋고 양쪽의 의미가 비슷하다면 한쪽만 부여해도 된다.

## 속성 도출 및 정의
논리 모델링 단계에서 속성 설계는 엔티티에서 관리하는 속성을 도출하여 식별하고 정의하는 과정이다. 업무요건을 만족할 수 있도록 모든 속성을 도출해야 하며, 속성명, 속성정의, 설명, 필수여부, 데이터타입 등을 정의해야한다.

### 속성 도출
__핵심 엔티티 속성__ : 핵심 엔티티의 경우 식별자 및 명칭, 특성/특징/제원, 접촉정보, 위치정보, 약관/정책, 관계 속성을 포함한다.

__중요 엔티티 속성/행위 엔티티 속성__ : 거래 주체나 대상 엔티티의 식별자에 해당하는 참조 식별자 등의 업무처리 정보를 포함한다. 모든 엔티티는 유형이나 분류에 해당하는 코드 성격의 데이터를 포함한다.

속성은 데이터표준의 도메인과 매우 깊은 관계가 있으며, 번호/코드, 명칭, 날짜 등 도메인을 중심으로 데이터 성격을 식별할 수도 있다.

### 속성명 부여
1. 속성명은 속성을 가장 명확하게 설명할 수 있는 명칭을 부여해야한다. 또한 전체 주제영역 내에서 동일한 의미와 체계(구성)를 가져야한다. 
2. 속성명은 간결하면서 너무 일반적이지 않아야 한다.  속성명에 대한 설명을 확인하지 않고도 어떤 의미인지 파악할 수 있는 정도로 명명해야 한다.
3. 속성명은 표준단어들의 조합으로 구성한다. 마지막 단어는 표준단어의 분류어로 구성하며, 데이터표준에서 정의한 도메인을 참조하여 정의한다.
4. 속성명은 표준 용어나 표준 단어를 사용하되 속성명 부여 규칙을 정하여 부여해야 일관성을 유지할 수 있다. 

### 속성 정의
속성에 대한 설명이나 데이터 발생 규칙등을 기술한다. 속성 정의는 작성하면 도움이 되지만 노력한 시간에 빟서는 중요성이 떨어진다. 작성하는 것을 원칙으로 하되 모든 엔티티에 추가되는 시스템 속성이거나 굳이 설명하지 않아도 누구나 의미를 알 수 있는 경우 속성명과 동일하게 기술하도록 가이드할 수 있다. 

### 식별자 지정
식별자는 유일하게 식별 가능한, 최소 속성으로 구성하고, 변하지 않으면서 반드시 존재하는 값이어야 한다. 모든 엔티티는 식별자를 가져야 하며, 식별자를 가지지 못하면 정상적인 엔티티가 아니라 단순히 데이터를 기록하는 로그 성격 데이터이거나 데이터로서 가치를 가지지 않는 임시 저장 성격의 데이터일 가능성이 높다.

* 본질 식별자 : 사원번호, 주민번호처럼 엔티티에 원래 존재하는 속성으로 구성된 식별자이다. (회원ID, 계좌번호 등을 부여하여 식별하는 경우도 흔함)
* 인조 식별자 : 인위적으로 부여한 일련번호 형식의 식별자

본질 식별자를 주 식별자로 하는 경우 엔티티를 대표하거나 변하지 않는 속성을 우선하는 것이 좋다. 어느 것이 주 식별자 역할이든 대체 식별자 역할이든지 데이터 발생 규칙을 정의하고 실체 무결성 제약조건(PK)을 설계해야한다. 

논리 데이터 모델은 업무 변경에 유연하게 대응할 수 있어야 하고, 확장성을 가져야 한다. 서로 다른 본질 식별자를 가진 엔티티를 통합할 때 본질 식별자를 그대로 사용하는 경우 구조가 복잡해진다. 본질 식별자를 사용하는 것보다 인조 식별자를 사용한다면 식별자를 변경할 가능성이 낮아지고, 설계 변경을 최소화할 수 있다. 

이처럼 본질 식별자 대신 인조 식별자를 사용하여 유연하고 확장 가능한 논리 모델을 설계할 수 있는 경우가 있다.
1. 엔티티 통합시 대상 엔티티의 식별자가 서로 다르거나 데이터 집합 단위가 다른 경우 본질 식별자 대신 인조 식별자를 정의할 수 있다.
2. 하위 엔티티에 대한 하위 엔티티가 존재할 때 식별자를 계속 상속받게 되므로 하위 엔티티로 내려갈 수록 식별자 속성 개수가 많아지게 되며 모델이 복잡해진다. 이때 개발 편의성 및 성능적인 이점을 제공하기 위해 인조 식별자를 추가하여 주 식별자로 사용한다.
3. 개인정보 암호화 대상에 해당하는 본질 식별자는 인조식별자를 활용하여 주 식별자로 정의하는 것이 일반적이다.
4. 본질 식별자에 대한 데이터가 들어 오지 않은 상태에서 업무 처리를 위해 인조 식별자를 추가하는 경우

### 도메인 및 데이터타입 지정
속성에서 도메인을 지정하거나 데이터타입을 지정하여 속성이 가질 수 있는 데이터 값의 범위를 정의한다. 

### 옵셔널리티(Not Null) 지정
엔티티에 데이터가 입력될 때 해당 속성 값이 반드시 값을 가져야 할 경우(필수), 값을 가지지 않아도 되는 경우(선택)으로 지정한다. 엔티티 간의 관계에 의해 생성된 속성은 관계에 정의된 규칙에 따라 Not Null 여부가 결정된다.

### Default 값 지정
데이터 값을 입력하지 않았을 때 기본값을 지정하는 것이다. 

### 데이터 모델 검토
고객의 요구사항을 모두 반영하고 있는지, 논리적인 오류는 없는지 등을 검토하여 데이터 모델의 완성도를 높이는 과정이다.
1. 자체 검토 : 구성요소에 대한 체크리스트를 바탕으로 자체적으로 데이터 모델을 검토하는 방법이다. 
2. 동료 검토 : 논리 모델링 중간에 동료 모델러에거 모델을 설명하고 질문과 답변하는 과정에서 모델의 문제점을 도출하여 반영한다.
3. 이해 관계자 리뷰 : 현업, 시스템 운영자, 응용설계자 등 이해 관계자를 대상으로 모델이나 업무를 설명한다. 
4. 산출물을 통한 검토 
