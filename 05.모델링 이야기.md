# 모델링 이야기
## 고객의 정의는?
고객 데이터는 거의 모든 조직에서 관리하고 있다. 흔히 고객유형을 자연인과 법인으로 나눈다. 자연인은 주민등록번호, 외국인등록번호, 여권번호로 식별하고, 법인은 법인등록번호로 식별한다. 식별번호나 이름 주소 등의 속성 자체만 가지고는 자연인, 법인, 단체가 크게 다르지 않다.

고객의 범주에 해당하는지를 판단하기 위해 다음의 기준을 정의했다.
1) 식별 가능한 : 주민등록번호, 여권번호, 사업자등록번호 등의 식별번호를 가진다.
2) 접촉 가능한 : 주소, 전화번호 등의 접촉 가능한 정보를 가짐
3) 지속 가능한 : 일회성 거래가 아닌 지속적인 거래를 위해 정보 관리 필요성이 있음
4) 거래 주체 : 실제 경제활동을 수행하는 단위이며 지칭할 수 있는 명칭을 가짐

## 개인정보 데이터 구조와 암호화
개인정보는 개인을 식별할 수 있는 정보를 통칭한다. 개인정보는 수집 및 저장, 이용 및 활용, 제공(위탁)/처리, 파기 등의 생명주기에 따라 데이터를 관리해야 한다. 최소한의 개인정보를 수집하고 저장할 수 있도록 데이터 모델을 설계해야하고 접근 권한 설정 및 접근 로그를 설계해야한다.
ㄷ
주민등록번호는 2014년 8월 7일 원칙적으로 수집을 금지하고 있다. 법령상 근거없이 보유하고 있는 주민등록번호도 파기해야한다. 개인정보를 수집하고 저장하는 경우 '개인정보 수집 및 이용 동의' 등의 개인정보동의 항목을 관리해야한다. 또 암호화 대상을 식별하고 정의한다. 암호화 대상은 행안부 고시 해설서와 방통위 금감원에서 기준을 제시하고 있다.

암호화할 경우 DB성능 문제를 고려해야한다. 

SELECT * FROM 고객 1)WHERE 주민등록번호= '9901011234567' 2)WHERE 주민등록번호 LIKE '990101%' 

조건1의 경우 화면으로부터 암호화한 값을 받아 비교하면 되므로 성능 문제 없이 동일한 결과를 얻을 수 있다. 조건2의 경우 암복호화 방식이 DB 함수로 제동괴는 플러그인 방식인 경우 함수기반 인덱스를 생성하여 LIKE 검색하면 된다. 하지만 API 방식이면 주민등록번호 암호화를 LIKE 검색하는 것이 불가능하다. 이 경우 생년월일 컬럼을 추가하여 해결하는 방법 밖에 없다.

*데이터 암호화 방식은 API방식(자바등 프로그래밍 언어별로 라이브러리 제공), 플러그인 방식(데이터 암복호화 처리를 위해 DB 함수제공), 하이브리드 방식(API방식, 플러그인방식을 함께 적용)이 있다. 

개인정보 파기는 DB에서 영구적으로 삭제하는 방법과 보존기한이 정해진 경우 운영DB에서 별도 파기보존 DB로 분리하여 보관하는 방법, 빅데이터 분석 등을 위해 가명, 범주화, 마스킹, 총계/평균값 대체 등으로 비식별화하여 보관하는 방법이 있다.

## 공통코드 어떻게 설계하나?
대부분의 회사에서 코드성 데이터를 관리하고 있으며 이런 데이터는 시간이 흘러도 잘 변하지 않는 특성을 가진다. 코드성 데이터를 관리하는 방법은 __공통코드 테이블에서 통합__ 하여 관리하는 방법과 __개별 테이블 형태인 목록성 코드__ 로 관리하는 방법이 있다. 공통코드는 코드, 코드명 등 비교적 간단한 속성만 관리할 때 사용하고, 목록성 코드는 자재코드, 계정코드 등 업무에서 중요하거나 비교적 많은 속성을 관리하고 데이터 간 상하 관계가 복잡한 형태를 가질 때 개별 테이블로 분리하여 관리하는 게 일반적이다.

1) 공통코드유형과 공통코드로 구성
2) 코드유형과 코드 엔티티 통합 형태
3) 코드유형과 코드 형태로 구성
4) 코드유형, 코드 간 종속 관계 형태
5) 코드의 부분집합으로 관리
6) 코드유형 간 포함관계 형태
7) 코드유형, 코드 통합 및 단일키 형태

## 시스템 사용자 및 프로그램 관리
시스템 사용자는 크게 내부 시스템을 이용하는 사용자와 홈페이지에서 회원가입을 통해 서비스를 이용하는 외부 시스템 사용자로 구분할 수 있다. 외부 시스템 사용자의 경우 회원정보와 함께 시스템을 이용하기 위한 로그인 ID, 비밀번호를 같이 등록하는 게 일반적이며, 하나의 엔티티에서 회원 정보와 시스템 사용자 정보를 같이 관리한다.

보통 SSO(Single Sign-on) 기능을 통해 한번의 사용자 인증 과정을 거쳐 여러 시스템에 접속할 수 있도록 구축되어 있으며 시스템 사용자 정보를 통합하여 관리하고 있다. 시스템에서 메뉴, 프로그램, 사용권한 정보를 관리하고 메뉴마다 권한 관리를 다르게 할 수 있으므로 메뉴권한 엔티티로 관리한다.

## 주소 코드 및 주소관리
정부에서는 2014년에 지번 주소체계 대신 도로명 주소 체계를 전면 시행하였다. 도로명 주소를 위한 시스템 구축은 도로명주소 안내시스템에서 제공하는 데이터 모델을 그대로 이용하거나 약간 변경해서 사용할 수 있다. 코드 테이블을 별도로 구축하지 않고 도로명주소 안내시스템에서 제공하는 인터페이스를 활용하여 고객 주소를 관리하는 방법도 있다.

## 통합
과도하게 엔티티를 통합하면 컬럼의 수가 많아지고 관리도 잘 되지 않는다. 넓은 의미의 데이터 통합은 정확하고 일관성 있는 정보를 제공하기 위한 일련의 활동으로, 데이터의 중복 및 불일치를 최소화하기 위한 데이터 구조의 통합, 물리적으로 흩어진 데이터를 업무규칙을 적용해 수집하고 통제하는 데이터 흐름의 통합, 데이터 표준 및 메타정보 등의 데이터 관리체계 구축을 포함한다.

데이터 모델 측면에서의 데이터 통합은 중복 데이터를 최소화하는 데이터 구조적인 통합에 초점을 맞추어져 있으며, 보통 엔티티 및 테이블의 통합을 의미한다. 데이터 통합에 대한 정답은 없다. 어떤 통합을 고려하는지를 분명히 하자

## 인조 식별자 언제 사용하나?
실질 식별자를 주 식별자로 하면 업무 정의도 명확하고, 데이터 집합을 이해하는 데도 많은 도움이 된다. 반면에 너무 많은 속성으로 주 식별자를 구성하면 자식 엔티티로 갈수록 주 식별자 속성이 더욱 많아져 불필요하게 많은 저장공간을 차지하고, 기본키 인덱스가 길어져 성능 문제도 발생할 수 있다.

실질 식별자로 구성하게 되면 부모 테이블의 컬럼을 가지고 있기 때문에 부모 테이블과 조인하지 않아도 되므로 처리시간을 줄일 수 있다. 하지만 이런 장점보다는 복잡한 구성으로 인해 비효율이 발생한다. 인조 식별자로 구성하는 경우 자식 엔티티 속성이 적어지고 단순해진다. 단점으로 인조키의 인덱스는 쓸모가 없다. 그래서 인덱스를 하나 더 만들어야한다.

주요 조회조건이 A테이블, B테이블로 나누어져 있다면 어느쪽을 읽으나 선행 테이블 조건에 해당하는 데이터가 많아 다수 건을 처리해야하고, 다른 테이블과 조인 후 테이블 조건에 의해 대부분 걸러지게 된다. 이때 조회조건을 중복으로 관리하게 된다면 불필요한 조인이 없어 성능 문제를 해결할 수 있다. 중복 속성 추가 및 인덱스를 구성할 때는 여러가지 액세스 형태를 종합적으로 판단하여 결정해야한다.

또 다른 경우는 본질 식별자 데이터 값이 변경되는 경우 인조 식별자를 설계하여 기본키로 정의할 수 있다. __(인조키를 사용해야하는 경우 - 키가 너무 많을때, 변경될 가능성이 있을때)__

## 점 이력을 선분 이력으로
어떤 데이터가 시간이나 업무 흐름에 따라 내용이나 상태가 변할 때 변경되는 정보를 효율적으로 관리하기 위해 이력 엔티티를 설계한다. 이력 엔티티는 모든 항목에 대한 이력을 관리하기 위해 원 엔티티와 거의 유사한 형태로 설계하거나 일부 항목에 대한 변경이나 상태를 관리하기 위해 관련된 속성을 식별하여 설계한다. 이력에서 기간별로 조회를 하려면 마지막 데이터만 저장하는 점 이력보다는 from~to 범위로 관리하는 선분이력으로 관리하는 것이 좋다.