# 데이터 모델링 이론
## 데이터 모델링이란
데이터 모델링은 영속성을 갖는 데이터에 대한 시스템 구조를 사람이 이해할 수 있도록 형상화하는 과정이다.
* 사람이 정보로서 의미있는 대상을 인지하고, 식별 (개념적)
* 식별한 것을 기호 등을 통해 추상화하여 표현 (논리적)
* 정보시스템의 데이터베이스로 구축하기 위해 추상화된 모델을 구체화된 형태로 변환 (물리적)

데이터 모델링을 업무 적용하면 각종 데이터와 업무 내용, 절차 등을 구축하고자 하는 시스템의 데이터베이스에 기록하여 지속적으로 관리하고 활용하기 위해 데이터를 구조화하고 형상화하는 과정이다. 데이터 모델링 작업은 현업 인터뷰, 업무 지침서, 용어집, 산출물 등 현행 업무를 파악하여 개념들을 정리하고 분휴하여 __엔티티, 속성, 관계__ 로 형상화하는 과정이다.

상품처럼 복합 정보를 포괄적으로 수용하고 있는 경우엔 엔티티로 식별하고, 상품명, 단가 등 단일 정보는 속성으로 식별한다. 

__ER 모델__ ) ER 모델은 표현하고자 하는 현실 세계의 업무를 개체와 관계 두 가지 개념으로 표현하는 모델이다. 비교적 이해하기 쉽고, 모델을 확장할 수 있어 가장 널리 활용되고 있다. ERD를 통해 실체와 관계를 도식화할 수 있다.

[ER 모델의 질적 특성]

1) 완전성 : 현실세계의 모든 업무적인 요구사항을 표현하고 있어야 한다.
2) 정확성 : ER 모델의 개념대로 데이터모델을 작성해야 한다.
3) 최소성 : 요구사항의 모든 특성이 ER 모델에 한 번만 나타나도록 설계해야한다. (데이터가 중복되지 않도록)
4) 자명성 : 별도의 보조자료 없이 설명이나 증명을 하지 않아도 요구사항에 대한 뜻이나 의미를 명확히 설명할 수 있어야 한다.
5) 확장성 : 향후 업무 범위나 규모가 확대되거나 변경될 경우 새로운 요구사항을 쉽게 반영할 수 있도록 유연한 모델을 설계해야한다.
6) 표현성 : 요구사항을 자연스럽게 표현하고, 추가적인 설명 없이도 의미를 쉽게 이해할 수 있도록 명확하게 설계해야한다.
7) 가독성 : 읽기 쉽고 뜻을 쉽게 알아차릴 수 있도록 표현해야한다. 일반적으로 위에서 아래, 왼쪽에서 오른쪽으로 표현하는 것이 가독성이 높다. 관계는 굽은 선을 최소화하고, 수직/수평 직선을 사용, 관계선의 교차는 최소화 한다. 속성은 중요한 정보를 위쪽에 표시하고 비슷한 특성을 서로 가까운 위치에 표시한다.

## ER 모델 구성요소
ER 모델의 구성요소로는 엔티티, 관계, 속성이 있으며, 속성과 관계 중 하나 이상의 조합으로 구성된 식별자를 포함한다.

### 엔티티
엔티티는 고객, 상품처럼 현실 세계에서 실제로 존재하는 실체이거나, 조직, 서비스, 직업처럼 개념적인 것이다. 데이터 모델 측면에서 엔티티는 업무를 구현하는 데 필요하고 관리해야 하는 주체, 대상, 행위 등의 모든 집합적인 것으로 정의할 수 있다.

엔티티는 적어도 둘 이상의 인스턴스가 존재할 수 있어야하고, 최소한 둘 이상의 속성이 있어야 하며, 반드시 각 인스턴스를 식별할 수 있는 속성이나 관계가 하나 이상 정의되어야 한다. 또한 엔티티는 슈퍼타입 엔티티, 서브타입 엔티티로 확장할 수 있다. 슈퍼타입, 서브타입 엔티티는 일반화/특수화 과정을 통해 도출되고, 슈퍼타입 엔티티는 하나 이상의 서브타입 엔티티와 관계된 일반화된 엔티티이며, 서브타입에 공통으로 존재하는 속성을 관리한다. 서브타입 엔티티는 각각의 서브타입에만 존재하는 고유한 속성을 관리한다.(서브타입은 슈퍼타입의 식별자, 속성, 관계 등 모든 특성을 상속받는다.)

__일반화__ ) 엔티티의 일반화는 엔티티 각각이 가지고 있는 고유한 특징을 일반화하여 공통의 속성으로 재정의한 것으로, 보편적인 의미보다는 공통적인 의미에 더 가깝다. ex)개인과 기업의 공통적인 성격을 묶어 고객으로 정의, 제품과 상품을 큰 틀에서 상품으로 재정의 등..

엔티티 일반화는 두 개 이상의 하위 수준 엔티티를 결합하여 상위 수준의 엔티티로 통합하는 상향식 접근 방식이다. 또 일반화는 인스턴스 존재 유형에 따라 완전/불완전, 배타적/포괄적 일반화로 나눌 수 있다.

상위 수준 엔티티의 모든 인스턴스가 하위 수준 엔티티의 인스턴스에 모두 존재하면 '완전 일반화', 일부만 존재하면 '불완전 일반화'로 나눌 수 있다. 상위 수준 엔티티의 모든 인스턴스가 하위 수준 엔티티 중 하나에만 존재한다면 '배타적 일반화', 둘 이상의 하위 엔티티에 속한다면 '포괄적 일반화'에 해당한다.

시스템 구축시 배타 관계를 해소하고 두 집합을 통합 테이블 형태로 설계하는 경우 UNION, outer join할 필요가 없어 개발 생산성이 증대되고, 성능 향상 효과도 기대할 수 있으나 속성이 같은 테이블에 혼합되어 존재하여 속성의 의미가 불분명해지고, FK 제약조건, NOT NULL 제약조건을 반영할 수 없어 데이터 무결성 문제가 발생할 수 있다.

일반화 장점과 단점을 고려하여 판단하자.

__특수화__ ) 특수화는 일반화의 반대 개념으로 하나의 상위 수준 엔티티를 두 개 이상의 하위 수준 엔티티로 분할하는 하향식 접근 방식이다.

__집단화__ ) 하나의 엔티티로 취급되는 두 개 엔티티 사이에서 나타나며, 해당 엔티티와의 관계가 상위 수준 엔티티로 대체된다. ex)고객과 상품간의 관계를 집단화 하여 주문 상품으로 재정의하고, 주문 상품과 배송회사 간의 관계인 배송관계로 표현한다.

엔티티는 관점에 따라 다양하게 분류할 수 있다.
* 엔티티 관계 : __강한 엔티티__ - 독립적으로 존재, 엔티티내에서 자체 식별자 사용, 고유하게 인스턴스 식별 가능 / __약한 엔티티__ - 다른 엔티티에 종속적 다른 엔티티의 식별자를 상속받아 사용하는 엔티티
* 엔티티 형태 : __독립 엔티티__ - 사람, 물건, 장소 등 원래부터 현실에 존재하는 엔티티 / __업무 중심 엔티티__ - 업무처리시 발생하는 데이터에 해당, 주제 영역에서 핵심이 된다. 예)주문, 결제, 배송 등 / __종속 엔티티__ - 주로 업무 중심 엔티티에서 1차 정규화로 분리된 엔티티에 해당. / __교차 엔티티__ - 두 개 이상의 엔티티 간에 발생하는 트랜잭션에 의해 생성되는 엔티티다. 대부분의 논리 모델링에서 다대다 관계를 해소하기 위해 도출됨
* 엔티티 생성 : __핵심 엔티티__ - 부모 엔티티를 갖지 않는 독립적이며, 핵심적인 엔티티 / __중요 엔티티__ - 핵심 엔티티 간의 거래 관계에 의해 생성되는 엔티티, 업무의 핵심이 되는 엔티티 / __행위 엔티티__ - 실제 업무 행위에 의해 지속해서 발생하는 거래 행위에 대한 엔티티
* 엔티티 형태 : __실체 엔티티__ - 눈으로 볼 수 있는 물리적인 형태를 가지는 엔티티 / __개념 엔티티__ - 물리적인 형태는 없으나 개념적으로 존재하는 비실체 엔티티 / __사건 엔티티__ - 업무 행위와 관련된 비실체 엔티티, 데이터가 빈번하게 생성되고 변경되는 특성이 있다.

### 관계
1) 관계수 : 엔티티와 엔티티 간의 대응되는 최대 인스턴스 수를 말한다. (1:1관계, 1:M관계, M:N관계)
2) 관계 선택성 : 해당 엔티티 인스턴스에 대해 상대 엔티티에 인스턴스가 반드시 존재해야 하는지 유무, (필수-필수 관계, 필수-선택 관계, 선택-선택 관계)
3) 식별자 상속 : __식별관계__ - 참조되는 상위 엔티티 식별자가 참조하는 하위 엔티티 식별자로 상속되는 경우 / __비식별관계__ - 식별자가 아닌 일반 속성으로 상속되는 관계
4) 관계 유형 : __기본 관계__ - 엔티티와 엔티티가 하나의 관계를 맺는다. 가장 일반적인 관계로 1:1, 1:M 관계에 해당함 / __재귀적 관계__ - 하나의 엔티티가 다른 엔티티가 아닌 자기 자신과 관계를 맺는 경우로 계층적인 구조를 표현할 때 유용하다. 재귀적 관계는 필수관계를 가질 수 없고 반드시 선택관계를 갖는다. / __병렬 관계__ - 엔티티와 엔티티 간에 두 개 이상의 관계를 맺는다. 예) 고객은 보험 계약의 계약자이면서 피보험자이기도 하다. / __슈퍼타입,서브타입__ - 공통 속성을 관리하는 슈퍼타입, 개별 속성을 관리하는 서브타입 엔티티는 배타적, 포괄적인 관계를 갖는다.
5) 관계 차원 : 관계에 참여하는 엔티티의 수를 의미한다. (단항관계, 이항관계, 삼항관계, n항관계) *삼항관계나 n항관계는 잘 나타나지 않는다.

### 속성
속성은 데이터를 표현하는 가장 작은 단위(한 속성에는 하나의 값만), 하나의 엔티티는 두 개 이상의 속성을 가지고, 속성명, 식별자여부, 옵셔널리티, 도메인 등으로 구성된다.

* 속성명 : 실체의 특성을 규정하는 속성 명칭으로 주문번호, 주문일자 등
* 식별자 여부 : 해당 속성이 엔티티 식별자에 해당하는지 표시
* 옵셔널리티 : 속성이 반드시 특정값을 가져야하는지에 대한 구분(필수, 선택)
* 도메인 : 속성이 허용하는 데이터 형식과 범위를 가지고 있다. (문자형, 숫자형, 날짜형 등)

속성은 속성 값의 구성, 성격에 따라 다양하게 분류할 수 있다.
* 단순 속성과 복합 속성 : 단순 속성은 더이상 분해할 수 없는 원자 값을 갖는다. 복합 속성은 단순 속성들의 조합으로 구성된다.
* 저장 속성과 파생 속성 : 저장 속성은 원래 존재하는 속성 파생 속성은 저장 속성이나 다른 파생 속성으로부터 파생된 속성이다(계산된 값 등)
* 단일 값 속성과 다중 값 속성 : 단일 값 속성은 성별, 생일처럼 사람에 대해 하나의 값만 가지는 속성, 다중 값 속성은 하나의 속성이 여러개의 값을 가지는 속성(취미 등) *다중값 속성은 모델링 과정에서 정규화를 통해 별도의 엔티티로 분리

### 식별자
식별자는 인티티에서 인스턴스를 개별적으로 식별할 수 있는 속성들이다. 특징으로 유일성(유일하게 식별할 수 있어야 함), 최소성(유일성을 만족하는 최소 속성들로 구성), 불변성(엔티티에 식별자 지정시 식별자의 값은 변하지 않아야 한다.), 존재성(식별자는 반드시 데이터 값이 존재해야한다. NOT NULL)이 있다.

또한 식별자는 실 세계에서 자연적으로 가지는 특성인지, 시스템에서 필요에 의해 추가한 속성인지에 따라 본질 식별자, 인조 식별자로 구분된다. 또 대표성 여부에 따라 주 식별자, 보조 식별자로 분류할 수도 있다. 

## 관계형 데이터 모델 이론
관계형 데이터 모델은 데이터를 2차원 테이블(표) 형식으로 정의하고 표현한 모델이다. 이러한 테이블 형태를 '릴레이션'이라고 하고, 릴레이션의 스키마(헤더)와 실제 값인 릴레이션 인스턴스로 구성된다.

릴레이션 스키마(구조)는 릴레이션 명(테이블명)과 어트리뷰트(컬럼명, 릴레이션을 구성하는 각 열)를 포함하고, 튜플(row, 릴레이션의 각 행)은 릴레이션 인스턴스에 해당한다. 릴레이션의 튜플은 모두 다른 값을 가지며 중복된 튜플을 허용하지 않는다. 튜플은 순서와 무관하며 순서에 의미가 없다. 또한 어트리뷰트는 원자값으로 구성되고, 어트리뷰트의 명칭은 서로 다르며 유일하지만 값은 동일해도 상관없다.

### 관계형 모델의 키
* 슈퍼키(Super Key) : 튜플을 고유하게 식별할 수 있는 속성 집합, 릴레이션은 한 개 이상의 슈퍼키를 가질 수 있고 모든 튜플에서 유일해야한다.
* 후보키(Candidate Key) : 튜플을 고유하게 식별할 수 있는 최소한의 속성 집합, 모든 후보키는 슈퍼키지만 모든 슈퍼키가 후보키는 아니다.
* 기본키(Primary Key) : 릴레이션은 하나 이상의 후보키가 있을수 있으며 그 중 하나만을 기본키로 선택할 수 있다.(유일성, 최소성을 가짐)
* 대체키(Alternate Key) : 후보키 중에 기본키가 아닌 후보키
* 외래키(Foreign Key) : 어떤 릴레이션의 어트피뷰트의 값이 다른 릴레이션에 속한 어트리뷰트의 기본키를 참조하는 경우, null허용, 중복된 튜플허용

### 제약 조건
제약조건은 키 제약조건과 무결성 제약조건으로 나눌 수 있으며, 무결성 제약조건에는 실체, 영역, 참조 무결성 제약조건이 있다.
* 키 제약조건 : 튜플을 유일하게 식별할 수 있는 어트리뷰트들로 구성, 다른 튜플의 키 값과 중복된 값이 있어서는 안된다.
* 실체 무결성 : 릴레이션의 기본키를 구성하는 모든 어트리뷰트는 null값이 아니어야 하고, 릴레이션 내에서 오직 하나의 값만 존재한다. (Not Null, unique)
* 영역 무결성 : 릴레이션내의 각 어트리뷰트 값은 반드시 정의된 도메인에 속한 값이어야 한다.
* 참조 무결성 : 자식 릴레이션의 외래키는 참조하는 부모 릴레이션의 기본키 값 이외의 값을 가질 수 없으며, 두 릴레이션의 값은 일관성을 유지해야한다.

### 함수 종속
함수 종속은 일종의 무결성 제약조건으로서 어떤 릴레이션 R에서 속성 X의 값 각각에 대해 속성 Y의 값이 오직 하나면 연관되어 있을 때 Y는 X에 함수적으로 종속되어 있다고 한다.

예) 고객 테이블의 고객번호, 고객명, 생년월일, 주소의 속성이 있을 때 고객번호 컬럼에 다른 컬럼들이 함수적으로 종속된다.

즉, 함수 종속성은 테이블의 특정 컬럼 A의 값을 알게되면 다른 컬럼 B의 값을 알 수 있을 때 컬럼 B는 컬럼 A에 함수적 종속성이 있다고 한다. 함수적 종속성은 정규형과도 관계가 있디.

제1정규형(완전 함수종속), 제2정규형(부분 함수종속), 제3정규형(이행적 함수종속), BCNF정규형(결정자 함수종속), 제4정규형(다중 값 종속), 제5정규형(조인 종속)

* 완전 함수종속 : 속성, 속성들의 집합 X에 대해 Y가 함수적으로 종속되나 X의 부분집합에 대하여는 함수적으로 종속하지 않는 경우, 예) 기본키가 주문번호, 상품코드로 구성된 테이블에서 주문 수량은 주문번호 또는 상품코드에 종속되는 것이 아니라 주문번호, 상품코드 조합에 종속된다. 이를 완전 함수종속성을 갖는다고 한다.
* 부분 함수종속 : 여러개의 속성이 모여서 하나의 기본키를 이룰 경우 기본키를 구성하는 일부 속성만으로도 종속관계가 결정되면 부분 함수종속이다.
* 이행적 함수종속 : 함수 종속관계 X->Y 와 Y->Z가 성립되면, 논리적 결과로 X->Z가 성립한다. 이때 Z는 X에 이행적 함수종속성을 갖는다. *이행적 함수종속은 데이터 변경이상의 원인이됨

### 정규화
정규화는 테이블에 대해 데이터를 입력, 수정, 삭제할 때 발생하는 이상 현상을 최소화하기 위해 좀 더 작은 단위의 테이블로 설계하는 과정이다. 정규화의 이점으로

1) 데이터를 입력, 수정, 삭제하는 과정에서 이상 현상을 최소화할 수 있다.
2) 종속성이 강한 데이터 요소들을 분리하여 독립된 개념으로 정의, 높은 응집력과 낮은 결합도 원칙에 충실하면서 데이터 구조 변경시 유연성이 증가한다.
3) 개념을 세분화할 경우 개념에 대한 재활용성이 높아진다.
4) Non-key 데이터 요소가 한번만 표현됨에 따라 중복을 최소화하고, 데이터 품질 문제를 줄일 수 있으며, 저장공간을 최소화할 수 있다.
5) 데이터 입력, 수정, 삭제에 대한 작업을 최소화하여 수행속도가 향상된다.

정규화로 인하여 조인이 빈번하게 발생하는 경우 성능이 저하될까 걱정할 수 있으나 반드시 성능 문제가 발생한다고 볼 수는 없고, 때로는 반정규화를 하여 문제를 해결할 수 있다. 허나 데이터 중복으로 인해 이상현상이 발생할 수 있으므로 반정규화는 제한적으로 사용하자.

*정규화는 ER모델이 아닌 관계형 모델과 관련이 있다. 또한 물리 모델링이 아닌 논리 모델링 과정에서 ER 모델 기법과 함께 적용하는 것이 일반적이다.

### 제1정규형
각각의 어트리뷰트에 대한 도메인은 원자 값이고, 각각의 어트리뷰트의 값은 단일 값이어야 한다. 관계형 테이블은 중복되는 행이 없어야 하고, 모든 열의 값은 원자 값을 가져야한다.(한 컬럼에 여러값X, 중복되는 컬럼X)

### 제2정규형
제1정규형을 만족하고, 키가 아닌 어트리뷰트는 후보키 전체에 종속되어야 한다.(부분 종속 제거)

### 제3정규형
제2정규형을 만족하고, 키가 아닌 어트리뷰트 간에는 서로 종속적인 관계가 없어야한다.(이행 함수종속 제거)

### 연결함정
관계형 모델에서 모호한 관계가 발생하는 현상으로 정규화 과정에서 무손실 분해의 원칙이 지켜지지 않아 원래 있던 관계성을 잃어 버리는 현상이다. 연결 함정에는 관계의 모호성 형태에 따라 '부채꼴 함정, '균열 함정'으로 나눌 수 있다.

* 부채꼴 함정 : 엔티티 사이에 관계가 정의되어 있지만 관계가 모호한 경우 발생, 다대다 관계를 해결하기 위해 교차 엔티티를 추가하면서 1:M 관계를 만들 때 나타난다.
* 균열 함정 : 엔티티 사이에 관계가 정의되어 있지만 일부 엔티티와 엔티티 사이의 관계가 존재하지 않는 경우에 발생, 이 경우 일부 누락된 관계를 추가하여 해결 할 수 있다.